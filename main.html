<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Visualer</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <canvas id="canvas"></canvas>
    <form onsubmit="return false">
        <label> Podaj wartość funkcji: </label>
        <input type="text" placeholder="format: x**2+4x+4" id="myFunction"><br>
        <button onclick="createRPNUserFunction()">DRAW</button>
    </form>
    <div class="siemka">
        <p>Tutaj sprawdzam funckje i własności kodu, fucknji, programu, itp: </p>
    </div>

    <script>

        var canvas = document.getElementById('canvas');
        var ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        var centerX = canvas.width / 2;
        var centerY = canvas.height / 2;
        let rangex = canvas.width/40;
        let rangey = canvas.height/20
        let number = -20;

        function draw(ctx){
            ctx.beginPath();
            ctx.moveTo(0, centerY);
            ctx.lineTo(canvas.width, centerY);
            ctx.moveTo(centerX, 0);
            ctx.lineTo(centerX, canvas.height);
            ctx.strokeStyle = "black";
            ctx.stroke();
        }

        
        for(i=0; i<=canvas.width; i+=rangex) {
                ctx.beginPath();
                ctx.fillText(number, i, centerY - 9)
                number++
                ctx.textAlign = "center"
                ctx.textBaseline = "middle"
                ctx.font = "10px Arial"
                ctx.moveTo(i, centerY - 5);
                ctx.lineTo(i, centerY + 5);
                ctx.strokeStyle = "black";
                ctx.stroke();
        }

        number = 10

        for(i=0; i<=canvas.height; i+=rangey) {
                ctx.beginPath();
                ctx.fillText(number, centerX - 9, i )
                number--
                ctx.textAlign = "center"
                ctx.textBaseline = "middle"
                ctx.font = "10px Arial"
                ctx.moveTo(centerX - 5, i);
                ctx.lineTo(centerX + 5, i);
                ctx.strokeStyle = "black";
                ctx.stroke();
        }
           

        draw(ctx);

        ctx.translate(centerX, centerY);
        ctx.scale(100,100);
        

        truthTableRPN = {
        '(' : 0,
        '+' : 1,
        '-' : 1,
        ')' : 1,
        '*' : 2,
        '/' : 2,
        '%' : 2,
        '^': 3
        }
        arrayFunction =[]
        stos =[]
        outline =[]
        function getValue(znak){
            let returnvalue = truthTableRPN[znak] ?? -1
            return returnvalue
        }

        function createRPNUserFunction(){
            const myFunction = document.querySelector("#myFunction").value
            const check = document.querySelector(".siemka")
            myFunction.replace(/\s/g, '');
            charArray = myFunction.match(/([\w\d]+)|[-\+\*\/\^\(\)]/g)

            for(i=0; i< charArray.length; i++){

                char = charArray[i]
                if (/[a-z0-9]/.test(char)){
                    arrayFunction.push(char)
                }
                else if(stos[stos.length-1] == '(' && char == '-'){
                    stos.push(char)
                    arrayFunction.push(0)
                }
                else if(char === ')'){
                    while(stos[stos.length-1] !== '('){
                        arrayFunction.push(stos[stos.length-1])
                        stos.pop()
                    }
                    stos.pop()
                }
                else if(char == '+' || char == '-' || char == '/' || char == '*' || char == '^' || char == '%'){
                    while (getValue(char) <= getValue(stos[stos.length-1])) {
                    arrayFunction.push(stos[stos.length-1])
                    stos.pop()}
                    stos.push(char)
                }
                else stos.push(char)
            }
            arrayFunction.push(stos[0])
            stos=''
            for (var i = 0; i < arrayFunction.length; i++) {
                if(arrayFunction[i] == '^') arrayFunction[i] = arrayFunction[i].replace('^', "**");
            }
            counter = 0
            for (let number = -20; number <= 20; number++) {
                array = changeValuesOfX(number, arrayFunction)
                outline.push(countYParameterFunction(array))
                counter++
            }
            drawFunctionGraph(-2, outline[19], counter)
            check.innerHTML += "pokaż stos: "+stos+'<br>'
            check.innerHTML += "pokaż wyjście: "+arrayFunction+'<br>'
            check.innerHTML += "pokaż wynik: "+outline+'<br>'
        }

        function changeValuesOfX(number, func){
                let temparrayFunction = func.slice();
                for(i=0; i < temparrayFunction.length; i++){
                    if(temparrayFunction[i] == 'x') temparrayFunction[i] = number;
                }
                return temparrayFunction
        }

        function countYParameterFunction(func){
            stos = []

            for(i=0; i < func.length; i++){
                if(/[0-9]/.test(func[i])){
                    stos.push(func[i])
                }
                else{
                    a = stos[stos.length-1]
                    stos.pop()
                    b = stos[stos.length-1]
                    stos.pop()
                    stos.push(mathCalc(Number(b),Number(a), func[i]))
                }
            }
            return stos.pop()
        }

        function mathCalc(firstVar, secondVar, operator){
            switch(operator){
                case '**':
                    return result = firstVar ** secondVar
                break;
                case '%':
                    return result = firstVar % secondVar
                break;
                case '*':
                    return result = firstVar * secondVar
                break;
                case '/':
                    return result = firstVar / secondVar
                break;
                case '+':
                    return result = firstVar + secondVar
                break;
                case '-':
                    return result = firstVar - secondVar
                break;
            }
        }

        function drawFunctionGraph(xParameter ,yParameter, counter){
            var c = document.getElementById("myCanvas");
            var ctx = c.getContext("2d");
            ctx.beginPath();
            ctx.moveTo(0, 0);
            ctx.quadraticCurveTo(xParameter, yParameter, -20, 20);
            ctx.stroke();
        }

    </script>
</body>
</html>